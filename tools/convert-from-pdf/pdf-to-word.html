<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF to Word Converter | Professional Tool</title>
    <!-- PDF.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <!-- docx.js library -->
    <script src="https://cdn.jsdelivr.net/npm/docx@7.8.2/build/index.min.js"></script>
    <!-- FileSaver.js for downloading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- AOS for animations -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <style>
        /* Base Styles & Reset */
        :root {
            --primary-color: #f33434;
            --primary-dark: #f36b22;
            --secondary-color: #e6a234;
            --text-color: #333;
            --text-light: #666;
            --text-dark: #111;
            --bg-light: #f8f9fa;
            --bg-white: #ffffff;
            --border-color: #ddd;
            --border-radius: 8px;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --primary-color: #f33434;
            --primary-dark: #f36b22;
            --secondary-color: #e6a234;
            --text-color: #f1f1f1;
            --text-light: #ccc;
            --text-dark: #e1e1e1;
            --bg-light: #121212;
            --bg-white: #1e1e1e;
            --border-color: #444;
            --box-shadow: 0 4px 20px rgba(255, 255, 255, 0.05);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-light);
            color: var(--text-color);
            line-height: 1.6;
            transition: var(--transition);
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        /* Header */
        .site-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            transition: var(--transition);
        }
        
        [data-theme="dark"] .site-header {
            background: rgba(30, 30, 30, 0.95);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .site-header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Theme Toggle */
        .theme-toggle {
            background: transparent;
            border: none;
            cursor: pointer;
            position: relative;
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .theme-toggle:hover {
            background: rgba(0, 0, 0, 0.05);
        }
        
        [data-theme="dark"] .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .theme-toggle i {
            position: absolute;
            transition: var(--transition);
            font-size: 1.2rem;
        }
        
        .theme-toggle .fa-sun {
            opacity: 0;
            transform: rotate(90deg);
            color: #ffd700;
        }
        
        [data-theme="dark"] .theme-toggle .fa-moon {
            opacity: 0;
            transform: rotate(90deg);
        }
        
        [data-theme="dark"] .theme-toggle .fa-sun {
            opacity: 1;
            transform: rotate(0);
        }

        /* Main Content */
        .main-content {
            padding: 3rem 0;
        }

        .tool-title {
            text-align: center;
            margin-bottom: 2rem;
            font-size: 2.5rem;
            position: relative;
            color: var(--primary-color);
        }

        .tool-title:after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background: var(--primary-color);
            margin: 1rem auto 0;
            border-radius: 2px;
        }

        /* Upload Area */
        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: 3rem 2rem;
            text-align: center;
            margin-bottom: 2rem;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            background-color: var(--bg-white);
            box-shadow: var(--box-shadow);
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
        }

        .upload-area.active {
            border-color: var(--primary-color);
            background-color: rgba(243, 52, 52, 0.05);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            transition: var(--transition);
        }

        .upload-text {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        .upload-hint {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        #pdf-input {
            display: none;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 6px;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
            margin-top: 1rem;
            overflow: hidden;
            display: none;
        }

        [data-theme="dark"] .progress-container {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .progress-bar {
            height: 100%;
            width: 0;
            background-color: var(--primary-color);
            transition: width 0.3s ease;
        }

        /* Settings Panel */
        .settings-panel {
            background-color: var(--bg-white);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
        }

        .settings-title {
            margin-bottom: 1.5rem;
            font-size: 1.2rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .settings-title i {
            font-size: 1.1rem;
        }

        .form-row {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        select, input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--bg-white);
            color: var(--text-color);
            font-size: 0.9rem;
            transition: var(--transition);
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(243, 52, 52, 0.2);
        }

        .margin-inputs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background-color: rgba(243, 52, 52, 0.1);
        }

        .btn i {
            margin-right: 0.5rem;
        }

        .btn .spinner {
            display: none;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        .btn.loading .spinner {
            display: inline-block;
        }

        .btn.loading span {
            display: none;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Preview Section */
        .preview-section {
            background-color: var(--bg-white);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
            display: none;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .preview-title {
            font-size: 1.2rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .page-count {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .preview-actions {
            display: flex;
            gap: 0.5rem;
        }

        .select-all {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
            user-select: none;
        }

        .select-all:hover {
            color: var(--primary-color);
        }

        .select-all-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
            max-height: 500px;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .page-thumbnail {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            aspect-ratio: 1/1.414; /* Standard paper aspect ratio */
        }

        .page-thumbnail:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .page-thumbnail.selected {
            box-shadow: 0 0 0 3px var(--primary-color);
        }

        .page-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
            background-color: #f5f5f5;
        }

        [data-theme="dark"] .page-image {
            background-color: #2a2a2a;
        }

        .page-checkbox {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            accent-color: var(--primary-color);
            cursor: pointer;
            opacity: 0;
            transition: var(--transition);
        }

        .page-thumbnail:hover .page-checkbox {
            opacity: 1;
        }

        .page-thumbnail.selected .page-checkbox {
            opacity: 1;
        }

        .page-number {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            font-size: 0.8rem;
        }

        /* Status Messages */
        .status {
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            font-size: 0.9rem;
            display: none;
        }

        .status.info {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--text-color);
            display: block;
        }

        .status.success {
            background-color: rgba(67, 238, 100, 0.1);
            color: #43a047;
            display: block;
        }

        .status.error {
            background-color: rgba(238, 67, 67, 0.1);
            color: #e53935;
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 1rem;
            }

            .preview-container {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .tool-title {
                font-size: 2rem;
            }

            .upload-text {
                font-size: 1rem;
            }

            .preview-container {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-file-word"></i>
                <span>PDF to Word</span>
            </div>
            <button class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon"></i>
                <i class="fas fa-sun"></i>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <h1 class="tool-title" data-aos="fade-down">PDF to Word Converter</h1>
            
            <!-- Upload Area -->
            <div class="upload-area" id="upload-area" data-aos="fade-up">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h3 class="upload-text">Drag & Drop your PDF file here</h3>
                <p class="upload-hint">or click to browse files</p>
                <input type="file" id="pdf-input" accept=".pdf">
                <div class="progress-container" id="progress-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
            </div>

            <!-- Status Message -->
            <div class="status" id="status"></div>

            <!-- Settings Panel -->
            <div class="settings-panel" data-aos="fade-up" data-aos-delay="100">
                <h3 class="settings-title">
                    <i class="fas fa-cog"></i>
                    Document Settings
                </h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="page-orientation">Page Orientation</label>
                        <select id="page-orientation">
                            <option value="portrait">Portrait</option>
                            <option value="landscape">Landscape</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="page-size">Page Size</label>
                        <select id="page-size">
                            <option value="A4">A4 (210 × 297 mm)</option>
                            <option value="Letter">Letter (8.5 × 11 in)</option>
                            <option value="Legal">Legal (8.5 × 14 in)</option>
                            <option value="A5">A5 (148 × 210 mm)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Page Margins (inches)</label>
                    <div class="margin-inputs">
                        <div class="form-group">
                            <label for="margin-top">Top</label>
                            <input type="number" id="margin-top" min="0" step="0.1" value="1">
                        </div>
                        <div class="form-group">
                            <label for="margin-right">Right</label>
                            <input type="number" id="margin-right" min="0" step="0.1" value="1">
                        </div>
                        <div class="form-group">
                            <label for="margin-bottom">Bottom</label>
                            <input type="number" id="margin-bottom" min="0" step="0.1" value="1">
                        </div>
                        <div class="form-group">
                            <label for="margin-left">Left</label>
                            <input type="number" id="margin-left" min="0" step="0.1" value="1">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Buttons -->
            <div class="button-group" data-aos="fade-up" data-aos-delay="200">
                <button class="btn" id="preview-btn" disabled>
                    <div class="spinner"></div>
                    <span><i class="fas fa-eye"></i> Preview PDF</span>
                </button>
                <button class="btn" id="convert-btn" disabled>
                    <div class="spinner"></div>
                    <span><i class="fas fa-file-word"></i> Convert to Word</span>
                </button>
                <button class="btn btn-secondary" id="reset-btn">
                    <i class="fas fa-redo"></i> Reset
                </button>
            </div>

            <!-- Preview Section -->
            <div class="preview-section" id="preview-section">
                <div class="preview-header">
                    <div>
                        <h3 class="preview-title">
                            <i class="fas fa-images"></i>
                            PDF Preview
                        </h3>
                        <div class="page-count" id="page-count">0 pages</div>
                    </div>
                    <div class="preview-actions">
                        <div class="select-all" id="select-all">
                            <input type="checkbox" class="select-all-checkbox" id="select-all-checkbox">
                            <label for="select-all-checkbox">Select All</label>
                        </div>
                    </div>
                </div>
                <div class="preview-container" id="preview-container"></div>
            </div>
        </div>
    </main>

    <!-- AOS Animation Library -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        // Initialize AOS animation library
        AOS.init({
            duration: 800,
            easing: 'ease-in-out',
            once: true
        });

        // Set PDF.js worker path
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.worker.min.js';
        
        // DOM elements
        const pdfInput = document.getElementById('pdf-input');
        const uploadArea = document.getElementById('upload-area');
        const previewBtn = document.getElementById('preview-btn');
        const convertBtn = document.getElementById('convert-btn');
        const resetBtn = document.getElementById('reset-btn');
        const previewSection = document.getElementById('preview-section');
        const previewContainer = document.getElementById('preview-container');
        const statusEl = document.getElementById('status');
        const themeToggle = document.getElementById('theme-toggle');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        const pageCountEl = document.getElementById('page-count');
        const selectAllCheckbox = document.getElementById('select-all-checkbox');
        const selectAllLabel = document.querySelector('#select-all label');
        
        // Settings elements
        const pageOrientation = document.getElementById('page-orientation');
        const pageSize = document.getElementById('page-size');
        const marginTop = document.getElementById('margin-top');
        const marginRight = document.getElementById('margin-right');
        const marginBottom = document.getElementById('margin-bottom');
        const marginLeft = document.getElementById('margin-left');
        
        // Store extracted pages
        let extractedPages = [];
        let selectedPages = [];
        
        // Theme toggle
        themeToggle.addEventListener('click', function() {
            const isDark = document.body.getAttribute('data-theme') === 'dark';
            document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        });
        
        // Check for saved theme preference
        if (localStorage.getItem('theme') === 'dark') {
            document.body.setAttribute('data-theme', 'dark');
        }
        
        // Upload area click handler
        uploadArea.addEventListener('click', function() {
            pdfInput.click();
        });
        
        // Drag and drop handlers
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('active');
        });
        
        uploadArea.addEventListener('dragleave', function() {
            this.classList.remove('active');
        });
        
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('active');
            
            if (e.dataTransfer.files.length) {
                pdfInput.files = e.dataTransfer.files;
                handleFileSelection();
            }
        });
        
        // File input change handler
        pdfInput.addEventListener('change', handleFileSelection);
        
        function handleFileSelection() {
            if (pdfInput.files && pdfInput.files[0]) {
                const file = pdfInput.files[0];
                
                // Validate file type
                if (file.type !== 'application/pdf' && !file.name.toLowerCase().endsWith('.pdf')) {
                    setStatus('Please select a valid PDF file.', 'error');
                    return;
                }
                
                // Check file size (limit to 20MB for client-side processing)
                if (file.size > 20 * 1024 * 1024) {
                    setStatus('File size exceeds 20MB limit. Please use a smaller PDF.', 'error');
                    return;
                }
                
                // Update UI
                uploadArea.querySelector('.upload-text').textContent = file.name;
                uploadArea.querySelector('.upload-hint').textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`;
                previewBtn.disabled = false;
                convertBtn.disabled = false;
                clearStatus();
            }
        }
        
        // Preview PDF button handler
        previewBtn.addEventListener('click', async function() {
            if (!pdfInput.files || !pdfInput.files[0]) return;
            
            try {
                showLoading(previewBtn);
                setStatus("Extracting pages from PDF...", 'info');
                previewContainer.innerHTML = "";
                progressContainer.style.display = 'block';
                
                const file = pdfInput.files[0];
                const fileUrl = URL.createObjectURL(file);
                
                // Show loading progress
                const loadingTask = pdfjsLib.getDocument({
                    url: fileUrl,
                    withCredentials: false
                });
                
                loadingTask.onProgress = function(progressData) {
                    const percent = Math.round((progressData.loaded / progressData.total) * 100);
                    progressBar.style.width = `${percent}%`;
                };
                
                const pdf = await loadingTask.promise;
                extractedPages = [];
                selectedPages = [];
                
                // Reset select all checkbox
                selectAllCheckbox.checked = false;
                selectAllLabel.textContent = 'Select All';
                
                // Process each page
                for (let i = 1; i <= pdf.numPages; i++) {
                    try {
                        const page = await pdf.getPage(i);
                        // Increase scale for better quality in Word doc
                        const viewport = page.getViewport({ scale: 2.0 });
                        
                        // Prepare canvas
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        
                        // Render PDF page to canvas
                        await page.render({
                            canvasContext: context,
                            viewport: viewport
                        }).promise;
                        
                        // Convert canvas to image
                        const imageData = canvas.toDataURL('image/png', 1.0); // Highest quality
                        extractedPages.push({
                            dataUrl: imageData,
                            width: viewport.width,
                            height: viewport.height
                        });
                        selectedPages.push(i); // Select page by default
                        
                        // Update progress
                        const percent = Math.round((i / pdf.numPages) * 100);
                        progressBar.style.width = `${percent}%`;
                        
                        // Update status periodically
                        if (i % 5 === 0 || i === pdf.numPages) {
                            setStatus(`Processing page ${i} of ${pdf.numPages}...`, 'info');
                        }
                    } catch (error) {
                        console.error(`Error processing page ${i}:`, error);
                        throw new Error(`Failed to process page ${i}. The PDF might be corrupted.`);
                    }
                }
                
                // Display preview
                displayPageThumbnails();
                previewSection.style.display = 'block';
                pageCountEl.textContent = `${extractedPages.length} page${extractedPages.length !== 1 ? 's' : ''}`;
                
                setStatus(`Successfully extracted ${extractedPages.length} pages.`, 'success');
                scrollToPreview();
            } catch (error) {
                setStatus("Error: " + error.message, 'error');
                console.error(error);
            } finally {
                hideLoading(previewBtn);
                progressContainer.style.display = 'none';
                progressBar.style.width = '0';
            }
        });
        
        // Display page thumbnails
        function displayPageThumbnails() {
            previewContainer.innerHTML = "";
            
            extractedPages.forEach((page, index) => {
                const pageNumber = index + 1;
                const thumbnail = document.createElement('div');
                thumbnail.className = `page-thumbnail ${selectedPages.includes(pageNumber) ? 'selected' : ''}`;
                thumbnail.innerHTML = `
                    <img src="${page.dataUrl}" alt="Page ${pageNumber}" class="page-image">
                    <input type="checkbox" class="page-checkbox" id="page-${pageNumber}" 
                           ${selectedPages.includes(pageNumber) ? 'checked' : ''} 
                           data-page="${pageNumber}">
                    <div class="page-number">Page ${pageNumber}</div>
                `;
                
                // Add click handler for the thumbnail
                thumbnail.addEventListener('click', function(e) {
                    // Don't toggle if checkbox was clicked directly
                    if (e.target.classList.contains('page-checkbox')) return;
                    
                    const checkbox = this.querySelector('.page-checkbox');
                    checkbox.checked = !checkbox.checked;
                    togglePageSelection(checkbox);
                });
                
                // Add change handler for the checkbox
                const checkbox = thumbnail.querySelector('.page-checkbox');
                checkbox.addEventListener('change', function() {
                    togglePageSelection(this);
                });
                
                previewContainer.appendChild(thumbnail);
            });
        }
        
        // Toggle page selection
        function togglePageSelection(checkbox) {
            const pageNumber = parseInt(checkbox.dataset.page);
            const thumbnail = checkbox.closest('.page-thumbnail');
            
            if (checkbox.checked) {
                if (!selectedPages.includes(pageNumber)) {
                    selectedPages.push(pageNumber);
                }
                thumbnail.classList.add('selected');
            } else {
                selectedPages = selectedPages.filter(p => p !== pageNumber);
                thumbnail.classList.remove('selected');
            }
            
            // Update select all checkbox
            updateSelectAllCheckbox();
        }
        
        // Update select all checkbox state
        function updateSelectAllCheckbox() {
            const allChecked = selectedPages.length === extractedPages.length;
            const someChecked = selectedPages.length > 0 && selectedPages.length < extractedPages.length;
            
            selectAllCheckbox.checked = allChecked;
            selectAllCheckbox.indeterminate = someChecked;
            
            if (allChecked) {
                selectAllLabel.textContent = 'Deselect All';
            } else {
                selectAllLabel.textContent = 'Select All';
            }
        }
        
        // Select all/deselect all handler
        selectAllCheckbox.addEventListener('change', function() {
            const checkboxes = previewContainer.querySelectorAll('.page-checkbox');
            
            if (this.checked) {
                // Select all pages
                selectedPages = Array.from({ length: extractedPages.length }, (_, i) => i + 1);
                checkboxes.forEach(checkbox => {
                    checkbox.checked = true;
                    checkbox.closest('.page-thumbnail').classList.add('selected');
                });
                selectAllLabel.textContent = 'Deselect All';
            } else {
                // Deselect all pages
                selectedPages = [];
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                    checkbox.closest('.page-thumbnail').classList.remove('selected');
                });
                selectAllLabel.textContent = 'Select All';
            }
        });
        
        // Convert to Word button handler
        convertBtn.addEventListener('click', async function() {
            if (extractedPages.length === 0) {
                setStatus("Please extract pages first by clicking Preview PDF.", 'error');
                return;
            }
            
            if (selectedPages.length === 0) {
                setStatus("Please select at least one page to convert.", 'error');
                return;
            }
            
            try {
                showLoading(convertBtn);
                setStatus("Converting to Word document...", 'info');
                
                // Filter pages based on selection
                const pagesToConvert = [];
                for (const pageNumber of selectedPages) {
                    if (pageNumber <= extractedPages.length) {
                        pagesToConvert.push(extractedPages[pageNumber - 1]);
                    }
                }
                
                await createWordDocFromImages(pagesToConvert);
                
                setStatus("Word document created successfully!", 'success');
            } catch (error) {
                setStatus("Error: " + error.message, 'error');
                console.error(error);
            } finally {
                hideLoading(convertBtn);
            }
        });
        
        // Reset button handler
        resetBtn.addEventListener('click', function() {
            // Reset file input
            pdfInput.value = '';
            uploadArea.querySelector('.upload-text').textContent = 'Drag & Drop your PDF file here';
            uploadArea.querySelector('.upload-hint').textContent = 'or click to browse files';
            
            // Reset preview
            previewContainer.innerHTML = '';
            previewSection.style.display = 'none';
            extractedPages = [];
            selectedPages = [];
            
            // Reset buttons
            previewBtn.disabled = true;
            convertBtn.disabled = true;
            
            // Reset status
            clearStatus();
            
            // Reset progress
            progressContainer.style.display = 'none';
            progressBar.style.width = '0';
            
            // Reset select all
            selectAllCheckbox.checked = false;
            selectAllCheckbox.indeterminate = false;
            selectAllLabel.textContent = 'Select All';
        });
        
        // Helper functions
        function setStatus(message, type = 'info') {
            statusEl.textContent = message;
            statusEl.className = 'status ' + type;
        }
        
        function clearStatus() {
            statusEl.textContent = '';
            statusEl.className = 'status';
        }
        
        function showLoading(button) {
            button.classList.add('loading');
            button.disabled = true;
        }
        
        function hideLoading(button) {
            button.classList.remove('loading');
            button.disabled = false;
        }
        
        function scrollToPreview() {
            if (previewSection.style.display === 'block') {
                previewSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }
        
        // Create Word document from images with configurable settings
        async function createWordDocFromImages(pages) {
            setStatus("Preparing Word document...", 'info');
            
            // Get settings from UI
            const orientation = pageOrientation.value;
            const size = pageSize.value;
            const margins = {
                top: parseFloat(marginTop.value),
                right: parseFloat(marginRight.value),
                bottom: parseFloat(marginBottom.value),
                left: parseFloat(marginLeft.value)
            };
            
            // Validate margins
            if (Object.values(margins).some(m => isNaN(m) || m < 0)) {
                throw new Error("Please enter valid margin values (numbers greater than or equal to 0)");
            }
            
            // Convert inches to twips (1 inch = 1440 twips)
            const marginTwips = {
                top: margins.top * 1440,
                right: margins.right * 1440,
                bottom: margins.bottom * 1440,
                left: margins.left * 1440
            };
            
            // Prepare document children
            const children = [];
            
            for (let i = 0; i < pages.length; i++) {
                try {
                    const page = pages[i];
                    const dataUrl = page.dataUrl;
                    
                    // Convert data URL to Uint8Array
                    const binaryString = atob(dataUrl.split(',')[1]);
                    const bytes = new Uint8Array(binaryString.length);
                    for (let j = 0; j < binaryString.length; j++) {
                        bytes[j] = binaryString.charCodeAt(j);
                    }
                    
                    // Add section break for each page except the first
                    if (i > 0) {
                        children.push(new docx.Paragraph({
                            children: [new docx.PageBreak()],
                        }));
                    }
                    
                    // Calculate image dimensions while maintaining aspect ratio
                    const maxWidth = 600; // Max width in points
                    const maxHeight = 800; // Max height in points
                    
                    let width = page.width * 0.75; // Convert from pixels to points (1px = 0.75pt)
                    let height = page.height * 0.75;
                    
                    // Maintain aspect ratio
                    if (width > maxWidth) {
                        const ratio = maxWidth / width;
                        width = maxWidth;
                        height = height * ratio;
                    }
                    
                    if (height > maxHeight) {
                        const ratio = maxHeight / height;
                        height = maxHeight;
                        width = width * ratio;
                    }
                    
                    // Add image to document
                    children.push(new docx.Paragraph({
                        children: [
                            new docx.ImageRun({
                                data: bytes,
                                transformation: {
                                    width: width,
                                    height: height,
                                },
                            }),
                        ],
                        spacing: {
                            before: marginTwips.top / 20, // Convert twips to points
                            after: marginTwips.bottom / 20,
                        },
                        indent: {
                            left: marginTwips.left / 20,
                            right: marginTwips.right / 20,
                        }
                    }));
                    
                    // Update status periodically
                    if (i % 5 === 0 || i === pages.length - 1) {
                        setStatus(`Processing page ${i + 1} of ${pages.length}...`, 'info');
                    }
                } catch (error) {
                    console.error(`Error processing page ${i + 1}:`, error);
                    throw new Error(`Failed to process page ${i + 1}. The conversion might be incomplete.`);
                }
            }
            
            // Create document with proper page settings
            const doc = new docx.Document({
                sections: [{
                    properties: {
                        page: {
                            margin: marginTwips,
                            size: {
                                orientation: orientation === 'landscape' ? 
                                    docx.PageOrientation.LANDSCAPE : docx.PageOrientation.PORTRAIT,
                                width: getPageWidth(size, orientation),
                                height: getPageHeight(size, orientation)
                            }
                        }
                    },
                    children: children
                }]
            });
            
            // Generate and download
            setStatus("Generating Word file...", 'info');
            const blob = await docx.Packer.toBlob(doc);
            saveAs(blob, "converted.docx");
        }
        
        // Helper function to get page dimensions based on size and orientation
        function getPageWidth(size, orientation) {
            // Dimensions in twips (1 inch = 1440 twips)
            const sizes = {
                'A4': { width: 8.27, height: 11.69 }, // inches
                'Letter': { width: 8.5, height: 11 },
                'Legal': { width: 8.5, height: 14 },
                'A5': { width: 5.83, height: 8.27 }
            };
            
            const dimensions = sizes[size] || sizes['A4'];
            return (orientation === 'landscape' ? dimensions.height : dimensions.width) * 1440;
        }
        
        function getPageHeight(size, orientation) {
            const sizes = {
                'A4': { width: 8.27, height: 11.69 }, // inches
                'Letter': { width: 8.5, height: 11 },
                'Legal': { width: 8.5, height: 14 },
                'A5': { width: 5.83, height: 8.27 }
            };
            
            const dimensions = sizes[size] || sizes['A4'];
            return (orientation === 'landscape' ? dimensions.width : dimensions.height) * 1440;
        }
    </script>
</body>
</html>